---
title: 线性逻辑的资源语义
author: 谢宇恒
date: 2025-01-15
---

# 资源语义

所谓资源语义，可以想象一个没有垃圾回收器的语言，
对于其中所有 value，都需要手动分配内存和手动回收内存。

更好的理解资源语义的方式是想象一个工厂的生产过程，
工厂有流水线，流水线有上下游，
上下游形成生产者和消费者关系，
设计流水线的时候可能要在某些地方做汇聚与分发，
某些地方可以通过并行提高生产效率。

为了解释一个逻辑的语义，需要解释的东西有：

- 逻辑判断（logic judgment）
- 逻辑连词（logic connective）
- 推演规则（inference rule）

# 解释逻辑判断

首先解释逻辑判断。
我们的逻辑中只有一种判断。

```
A, B |- C, D
```

这种形式的判断被称作 sequent。

可以解释为一个反应。
这个反应消耗一个 A 类资源和一个 B 类资源，
要等待这两个资源要同时到齐反应才能开始；
产生一个 C 类资源和 D 类资源，
可能会先产生其中的一个资源，
经过一段时间再产生另一个。
想象一个工厂的生产过程，此时「反应」就是加工过程，
为了提高生产效率，先产生的资源可以先拿给后续的工序使用。

设想带有类型系统的反应网（interaction nets）。
这个逻辑判断可以被理解为某个原始节点（primitive node）的类型。

```
[a: A] [b: B]
   \    /
   (node)
   /    \
[c: C] [d: D]
```

这个节点有两个主端口（principle port），分别是 a 和 b，
只有当这两个端口的数据都到齐了反应才能开始，
所谓「数据到齐」，其信号就是这两个端口所连接的，
都是别的节点的主端口了。
根据反应网的反应规律，
反应开始时主端口的连接线（wire）都会被拆除了，
当前反应的节点本身也会被删除，
两个非主端口的连接线会暴露出来，
也就是这里的 c 和 d。
反应的过程就是生成新的节点，
并且把这两个暴露出来的连接线重新连上。
就像工厂的生产过程一样，
显然重新连上 c 和 d 的时间可能是不同的，
先连上的就可以被后续的反应先用到。

# 解释逻辑连词

线性逻辑的连词表：

| 连词 | 算术 | 逻辑 | 名字（Girard） | 名字     |
|------|------|------|----------------|----------|
| ⨂    | 乘   | 与   | times          | conj-mul |
| &    | 加   | 与   | with           | conj-add |
| ⨁    | 加   | 或   | plus           | disj-add |
| ⅋    | 乘   | 或   | par            | disj-mul |
| !    | 幂   |      | of course      |          |
| ?    | 幂   |      | why not        |          |

解释表：

| 连词  | 消费者解释                         |
|-------|------------------------------------|
| A ⨂ B | 资源 A 和 B 同时存在               |
| A & B | 可以在资源 A 和 B 之间选择一个     |
| A ⨁ B | 将会在资源 A 和 B 之间随即产生一个 |
| A ⅋ B | 资源 A 和 B 不同时存在             |
| !A    | 资源 A 可以被使用任意多次          |
| ?A    |                                    |

否定词记为 `~` 代表消费和生产之间的转换。
详情请看对 imp-production 这条推演规则的解释。

线性蕴含被定义为衍生连词。

| 衍生连词 | 衍生方式 | 名字（Girard） |
|----------|----------|----------------|
| A -o B   | ~A ⅋ B   | entails        |

| 衍生连词 | 消费者解释                     |
|----------|--------------------------------|
| A -o B   | 可以消耗一个 A 生产一个 B 一次 |

# 解释推演规则

每个连词有两个推演规则。

在四个二元连词之中，
我认为 conj-add 和 disj-add 是最好理解的。
在其中可以看到选择权在消费者和生产者之间转移。
其中 conj-add 是「可选资源包」，
而 disj-add 是「随机资源包」。

conj-mul 和 disj-mul 比较难理解。
它们与逻辑判断本身的意义密切相关。

其实它们人别是逻辑判断本身的 sequent 中左边和右边的逗号。

```
A1 ⨂ ... An ⊢ B1 ⅋ ... Bn
```

其中 conj-mul 是「同步资源包」，
而 disj-mul 是「异步资源包」。

## conj-add

```
Γ ⊢ A, Δ
Γ ⊢ B, Δ
------------- conj-add-production
Γ ⊢ A & B, Δ
```

作为生产者，如果消耗同样的资源 Γ，
我既有办法生产出一个 A，
我也有办法生产出一个 B，
那么我可以把我的方案打包在一起，
给消费者做选择。
规则中 Δ 是副产品。

```
Γ, A ⊢ Δ
------------- conj-add-consumption-left
Γ, A & B ⊢ Δ
```

```
Γ, B ⊢ Δ
------------- conj-add-consumption-right
Γ, A & B ⊢ Δ
```

作为消费者，如果我能消费 A，
那么给我一个可在 A B 之间做选择的方案，
我只要把 A 选出来，就可以把它当作 A。
B 也是如此。

## disj-add

```
Γ, A ⊢ Δ
Γ, B ⊢ Δ
-------------- disj-add-consumption
Γ, A ⨁ B ⊢ Δ
```

作为消费者，在某个加工过程中，
如果我既能利用 A 又能利用 B 做出同样的效果，
那么面对随机产生 A 或 B 的资源包，
我也同样能使用。

```
Γ ⊢ A, Δ
-------------- disj-add-production-left
Γ ⊢ A ⨁ B, Δ
```

```
Γ ⊢ B, Δ
-------------- disj-add-production-right
Γ ⊢ A ⨁ B, Δ
```

作为生产者，如果我能生产 A，
那么我可以宣称我能生产随即产生 A 或 B 的一种资源包，
虽然在这个资源包中我只放进去了 A。
B 也是如此。

## conj-mul

```
Γ ⊢ A, Δ
Θ ⊢ B, Λ
-------------------- conj-mul-production
Γ, Θ ⊢ A ⨂ B, Δ, Λ
```

作为生产者，如果我既能生产 A 又能生产 B，
并且我想要将 A 与 B 捆绑销售，
我可以把 A 和 B 打包成资源包，
消费时必须同时消费里面的所有资源。

```
Γ, A, B ⊢ Δ
-------------- conj-mul-consumption
Γ, A ⨂ B ⊢ Δ
```

这个规则就是说 ⨂ 是 sequent 左边的逗号。

## disj-mul

```
Γ, A ⊢ Δ
Θ, B ⊢ Λ
------------------- disj-mul-consumption
Γ, Θ, A ⅋ B ⊢ Δ, Λ
```

作为消费者，如果我可以分别在两条生产线上并行地利用到 A 和 B。
那么我可以使用 A 和 B 的异步资源包，
来促进并行以提高生产效率。

```
Γ ⊢ A, B, Δ
------------- disj-mul-production
Γ ⊢ A ⅋ B, Δ
```

这个规则就是说 ⅋ 是 sequent 右边的逗号。

## cut

```
Γ ⊢ A, Δ
Θ, A ⊢ Λ
------------ cut
Γ, Θ ⊢ Δ, Λ
```

如果我有一条流水线可以消耗 Γ 生产 A 和副产品 Δ，
又有一条流水线可以消耗 Θ 和 A 生产 Λ。
那么我可以把流水线组合起来，
消耗 Γ 和 Θ 生产 Δ 和 Λ。
这种组合方式会导致 Γ 会先于 Θ 被消耗，
但是由于 Γ 和 Θ 被打包在 sequent 左边，
这个细节已经被忽略了。
并且副产品 Δ 一定会先于 Λ 被生产出来，
但是由于 Δ 和 Λ 被打包在 sequent 右边，
这个细节也被忽略了。
经过组合的整条流水线在外部看来，
就是同步消耗 Γ 和 Θ，
并且异步生产 Δ 和 Λ，
生产 Δ 和 Λ 的顺序，
我们已经不做保证了。

## linear implication

```
Γ, A ⊢ B, Δ
-------------- imp-production
Γ ⊢ A ⊸ B, Δ
```

作为生产者，如果我能消耗 Γ 和 A 生产 B 和 Δ，
那么我可以把我的能力打包成外包服务，
消耗 Γ 可以生产出一次外从 A 生产 B 的包服务和副产品 Δ。
同样，对副产品的产生时间也不做保证。

```
Γ ⊢ A, Δ
Θ, B ⊢ Λ
-------------------- imp-consumption
Γ, Θ, A ⊸ B ⊢ Δ, Λ
```

作为消费者，如果我有一条生产线能消耗 Γ 生产 A 和 Δ，
并且有另一条生产线能消耗 Θ 和 B 生产 Λ。
那么通过购买 A ⊸ B 外包服务，
我就能组合出一条消耗 Γ 和 Θ 生产 Δ 和 Λ 的生产线。

另外，imp-production 这条推演规则对于理解否定词而言很重要。
因为 `A -o B` 定义为 `~A ⅋ B`，并且 sequent 右边的逗号就是 `⅋`，
所以 imp-production 也可以写成：

```
Γ, A ⊢ B, Δ
-------------- imp-production
Γ ⊢ ~A, B, Δ
```

就像负数可以让我们表达「产生债务」一样，
这里的否定词也可以让我们表达「生产对某个资源的需求」。

注意，如果允许这样自由地使用否定词，
原本包含在 `A -o B` 中的 B 对 A 的依赖关系，
就会在 `~A ⅋ B` 这个表达式中消失，
反正异步的资源包对其中资源的时间不作任何保证。
比如可以有这样的等式：

```
(A -o B) ⅋ C =
~A ⅋ B ⅋ C =
B ⅋ ~A ⅋ C =
B ⅋ (~A ⅋ C) =
B ⅋ (A -o C)
```

只有完全禁止使用否定词，
才能让 `A -o B` 所表达的信息更具体。

允许否定词，就会得到量词之间的诸多等式，

练习：模仿在古典命题演算中用推演规则证明古典逻辑等式，
用这里的推演规则证明线性逻辑等式。

# 关于反应网

在设计带有类型系统的反应网的时候，
节点的端口带有类型，但是反应规则是没有类型的。

运行时可反应的信号依然是主端口相互连接。
主端口的意义在于，连接到这个端口的节点会在反应时被消除。

TODO 主端口与输入输出的关系。
TODO 如何理解 inet 中每个节点只能有一个 principle port 这种限制？

工厂流水线的语义与 petri nets 更接近，
而 interaction nets 是与 petri nets 不同的计算模型。
interaction nets 不能被理解为工厂流水线的原因是，
其网络的结构一直在变动。

如果不考虑 dependent type，二者可以有相同的类型系统，
一旦考虑 dependent type，所 depends 的就对象完全不同了。

# 后续工作

TODO 以这里的语义基础，去理解线性逻辑的其他文献。

比如，在这种对 linear logic 的解释下，
我可以更好地理解 1995-from-proof-nets-to-interaction-nets 吗？

# 参考资料

- Interaction Nets, Yves Lafont, 1990 (the founding paper).
- Interaction Combinators, Yves Lafont, 1997.
- [A Practical Interpretation of Linear Logic](https://protovision.github.io/#!/documents/blog/linear-logic.html), Mark Swoope, 2022.
